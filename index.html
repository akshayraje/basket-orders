<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zerodha Kite Basket Orders</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <style>
    @media (min-width: 992px) {
        .base-grid .col-lg:nth-of-type(1) {flex-grow: 20;}
        .base-grid .col-lg:nth-of-type(2) {flex-grow: 1;}
        .base-grid .col-lg:nth-of-type(3) {flex-grow: 20;}
    }
    </style>
</head>
<body>
<div class="container-fluid">
    <div class="row base-grid">
        <div class="col-12 col-lg">
            <div class="row vh-100">
                <textarea id="csv" class="form-control w-100 h-100" placeholder="exchange,tradingsymbol,quantity,transaction_type,product,order_type
NSE,JSWSTEEL,57,BUY,CNC,MARKET
NSE,INFY,26,SELL,CNC,MARKET"></textarea>
            </div>
        </div>   
        <div class="col-12 col-lg d-flex align-items-center">
            <button id="parse" class="btn btn-primary" style="text-align: center;">&#8594;</button>
        </div> 
        <div class="col-12 col-lg">
            <div class="row vh-100">
                <iframe name="kite_frame" style="width:100%; height:100%; border:0"></iframe>
            </div>
        </div> 
    </div>    
</div> 
<div id="kite_wrapper"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.6.2/papaparse.min.js"></script>
<script src="https://kite.trade/publisher.js?v=3"></script>
<script>
var api_key = "i02zbmhf3t7zeh3t";
var results = null;
var kite = null;
KiteConnect.ready(function() {
    kite = new KiteConnect(api_key);
    kite.setOption('redirect_url', '#');
});
parse.addEventListener('click', function(event) {
    event.preventDefault();
    results = Papa.parse(csv.value, {
        header: true,
        dynamicTyping: true
    });
    console.log('Raw parsed results: ', results);
    KiteConnect.ready(function() {
        kite = new KiteConnect(api_key);
        kite.setOption('redirect_url', '#');
        results.data.forEach(function(item) {
            kite.add(item);
        });
        console.log('kite.get(): ', kite.get());
        var kite_html = kite.html().replace('<form', '<form target="kite_frame" id="kite_form"');
        kite_wrapper.innerHTML = kite_html;
        kite_form.submit();
    });
})
</script>    
</body>
</html>
